<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventário de Equipamentos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Inventário de Equipamentos do IA-SAUDE</h2>
        <form id="equipForm" class="row g-3 mb-4">
            <!-- Formulário para inserção de dados -->
            <div class="col-md-6">
                <label for="modelo" class="form-label">Modelo</label>
                <input type="text" class="form-control" id="modelo" required>
            </div>
            <div class="col-md-6">
                <label for="serie" class="form-label">Número de Série</label>
                <input type="text" class="form-control" id="serie" required>
            </div>
            <div class="col-md-4">
                <label for="categoria" class="form-label">Categoria</label>
                <select id="categoria" class="form-select" onchange="showOtherField()">
                    <option selected>Escolher...</option>
                    <option value="Monitor">Monitor</option>
                    <option value="Mouse">Mouse</option>
                    <option value="Teclado">Teclado</option>
                    <option value="Router">Router</option>
                    <option value="Torre">Torre</option>
                    <option value="AP">Access Point</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>
            <div class="col-md-4" id="categoriaOutroDiv" style="display:none;">
                <label for="categoriaOutro" class="form-label">Especificar Categoria</label>
                <input type="text" class="form-control" id="categoriaOutro">
            </div>
            <div class="col-md-4">
                <label for="utilizador" class="form-label">Utilizador</label>
                <input type="text" class="form-control" id="utilizador">
            </div>
            <div class="col-md-6">
                <label for="localizacao" class="form-label">Localização</label>
                <input type="text" class="form-control" id="localizacao">
            </div>
            <div class="col-12">
                <button type="submit" class="btn btn-primary">Adicionar ao Inventário</button>
            </div>
        </form>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Modelo</th>
                    <th>Número de Série</th>
                    <th>Categoria</th>
                    <th>Utilizador</th>
                    <th>Localização</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
        <button class="btn btn-primary" onclick="exportTableToCSV('inventario.csv')">Exportar para Excel</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadTableData();
        });

        document.getElementById('equipForm').addEventListener('submit', function(event) {
            event.preventDefault();
            addRow();
            saveTableData();
        });

        function showOtherField() {
            const categoria = document.getElementById('categoria').value;
            const categoriaOutroDiv = document.getElementById('categoriaOutroDiv');
            categoriaOutroDiv.style.display = categoria === 'Outro' ? 'block' : 'none';
        }

        function addRow() {
            const table = document.getElementById('tableBody');
            const row = table.insertRow();
            const fields = ['modelo', 'serie', 'categoria', 'utilizador', 'localizacao'];
            fields.forEach(function(field) {
                const cell = row.insertCell();
                let value = document.getElementById(field).value.trim();
                if (field === 'categoria' && value === 'Outro') {
                    value = document.getElementById('categoriaOutro').value.trim();
                }
                cell.textContent = value || 'S/R'; // Usar 'S/R(sem resposta)' para valores não fornecidos
            });

            const deleteCell = row.insertCell();
            const deleteButton = document.createElement('button');
            deleteButton.textContent = 'Remover';
            deleteButton.className = 'btn btn-danger btn-sm';
            deleteButton.onclick = function() {
                row.remove();
                saveTableData();
            };
            deleteCell.appendChild(deleteButton);
        }

        function loadTableData() {
            const data = JSON.parse(localStorage.getItem('equipData') || '[]');
            data.forEach(function(equip) {
                const row = document.getElementById('tableBody').insertRow();
                equip.forEach(function(value, i) {
                    const cell = row.insertCell();
                    cell.textContent = value;
                });
                const deleteCell = row.insertCell();
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Remover';
                deleteButton.className = 'btn btn-danger btn-sm';
                deleteButton.onclick = function() {
                    row.remove();
                    saveTableData();
                };
                deleteCell.appendChild(deleteButton);
            });
        }

        function saveTableData() {
            const table = document.getElementById('tableBody');
            const data = [];
            for (let i = 0; i < table.rows.length; i++) {
                const row = table.rows[i];
                const rowData = [];
                for (let j = 0; j < row.cells.length - 1; j++) {
                    rowData.push(row.cells[j].textContent);
                }
                data.push(rowData);
            }
            localStorage.setItem('equipData', JSON.stringify(data));
        }

        function exportTableToCSV(filename) {
            const csv = [];
            const rows = document.querySelectorAll('table tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = [], cols = rows[i].querySelectorAll('td, th');
                
                for (let j = 0; j < cols.length; j++) 
                    row.push('"' + cols[j].innerText.replace(/"/g, '""') + '"');
                
                csv.push(row.join(','));
            }
            
            const csvFile = new Blob([csv.join('\n')], {type: 'text/csv'});
            const downloadLink = document.createElement('a');
            downloadLink.download = filename;
            downloadLink.href = window.URL.createObjectURL(csvFile);
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
    </script>
</body>
</html>
