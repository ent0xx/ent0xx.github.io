<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventário de Equipamentos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Inventário de Equipamentos do IA-SAUDE</h2>
        <form id="equipForm" class="row g-3 mb-4">
            <!-- Campos do formulário -->
        </form>
        <table class="table table-bordered">
            <!-- Cabeçalho da tabela -->
            <tbody id="tableBody">
            </tbody>
        </table>
        <button class="btn btn-primary" onclick="exportTableToCSV('inventario.csv')">Exportar para Excel</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadTableData();
        });

        document.getElementById('equipForm').addEventListener('submit', function(event) {
            event.preventDefault();
            addRow();
            saveTableData();
        });

        function addRow() {
            const table = document.getElementById('tableBody');
            const row = table.insertRow();
            const fields = ['modelo', 'serie', 'categoria', 'monitor', 'rato', 'teclado', 'router', 'torre', 'ap', 'utilizador', 'localizacao'];
            fields.forEach(function(field) {
                const cell = row.insertCell();
                let value = document.getElementById(field).value.trim(); // Trim whitespace
                if (field === 'categoria' && document.getElementById('categoria').value === 'Outro') {
                    value = document.getElementById('categoriaOutro').value.trim();
                }
                cell.textContent = value === '' ? 'S/R' : value; // Use 'S/R' if the field is empty
                document.getElementById(field).value = ''; // Clear the form field after adding
            });
            document.getElementById('categoria').value = 'Escolher...'; // Reset dropdown
            document.getElementById('categoriaOutro').style.display = 'none'; // Hide the 'Outro' input field
            const deleteBtn = row.insertCell();
            deleteBtn.innerHTML = '<button class="btn btn-danger btn-sm" onclick="deleteRow(this); saveTableData();">Eliminar</button>';
        }

        function deleteRow(btn) {
            const row = btn.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }

        function saveTableData() {
            const table = document.getElementById('tableBody');
            const rowsData = Array.from(table.rows).map(row => {
                return Array.from(row.cells).map(cell => cell.textContent);
            });
            localStorage.setItem('tableData', JSON.stringify(rowsData));
        }

        function loadTableData() {
            const data = JSON.parse(localStorage.getItem('tableData'));
            if (data) {
                const table = document.getElementById('tableBody');
                data.forEach(rowData => {
                    const row = table.insertRow();
                    rowData.forEach(text => {
                        const cell = row.insertCell();
                        cell.textContent = text;
                    });
                    const deleteBtn = row.insertCell();
                    deleteBtn.innerHTML = '<button class="btn btn-danger btn-sm" onclick="deleteRow(this); saveTableData();">Eliminar</button>';
                });
            }
        }
    </script>
</body>
</html>
